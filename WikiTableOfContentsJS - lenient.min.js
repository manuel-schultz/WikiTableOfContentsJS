function getAllHeadings() { return document.querySelectorAll("h1, h2, h3, h4, h5, h6") } function getHeadingBefore(e) { let t = Array.from(getAllHeadings()); return (index = t.indexOf(e)) >= 1 ? t[index - 1] : null } function displayChapterNumber(e) { e.innerText = e.dataset.number + " " + e.innerText } function displayChapterInTOC(e) { let t = document.getElementsByClassName("list-with-sublist")[0]; if ("1" === e.tagName[1]) var a = "<b class='toc-expand-chapter' onclick='tocExpandChapter(this)'>+</b>", n = "", l = ""; else var a = "", n = e.dataset.number.split(".")[0], l = "non-displayed-toc-chapter"; sanitizedTitle = e.dataset.title.replaceAll("'", "&apos;").replaceAll('"', "&quot;"), t.innerHTML += "<div class='toc-chapter toc-h" + e.tagName[1] + " " + l + "' data-mainChapter='" + n + "'><span class='toc-chapter-number'>" + e.dataset.number + "</span><a class='toc-move-to-header' title='" + sanitizedTitle + "' onclick='tocGoTo( this )'>" + e.dataset.title + "</a>" + a + "</div>" } function goThroughHeadings() { Array.from(getAllHeadings()).forEach((e, t) => { let a = calculateChapterNumber(e, t); e.dataset.number = a, e.dataset.title = e.innerText, displayChapterNumber(e), displayChapterInTOC(e) }), displayChapterTocExpander() } function calculateChapterNumber(e, t) { let a = getHeadingBefore(e), n = ""; if (null === a) n = "1"; else if (a.tagName === e.tagName) { let l = a.dataset.number.split("."); l = l.map(e => parseInt(e)), l[l.length - 1] += 1, n = l.join(".") } else if (parseInt(a.tagName.charAt(1)) < parseInt(e.tagName.charAt(1))) n = a.dataset.number + ".1"; else if (parseInt(a.tagName.charAt(1)) > parseInt(e.tagName.charAt(1))) { let r = Array.from(getAllHeadings()), i = r[r.slice(0, t).map(e => e.tagName).lastIndexOf(e.tagName)].dataset.number.split("."); i = i.map(e => parseInt(e)), i[i.length - 1] += 1, n = i.join(".") } return "." === n[0] && (n = n.substring(1)), n } function displayChapterTocExpander() { Array.from(document.getElementsByClassName("toc-expand-chapter")).map(function (e) { let t = e.parentElement.children[0].innerText; 0 === document.querySelectorAll(".toc-chapter[data-mainChapter='" + t + "']").length && (e.style.display = "none") }) } function tocGoTo(e) { let t = "[data-number='" + e.previousElementSibling.innerText + "']", a = parseInt(document.querySelectorAll(t)[0].offsetTop); window.scrollTo({ top: a, behavior: "smooth" }) } function tocExpandChapter(e) { let t = e.parentElement.children[0].innerText, a = Array.from(document.querySelectorAll(".toc-chapter[data-mainChapter='" + t + "']")); "+" === e.innerText ? (a.map(e => e.classList.add("displayed-toc-chapter")), a.map(e => e.classList.remove("non-displayed-toc-chapter")), e.innerText = "-") : "-" === e.innerText && (a.map(e => e.classList.remove("displayed-toc-chapter")), a.map(e => e.classList.add("non-displayed-toc-chapter")), e.innerText = "+") }